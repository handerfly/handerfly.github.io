---
layout:     post
title:      Logstash总结
date:       2019-10-04
author:     BenderFly
header-img: img/post-bg-coffee.jpeg
catalog: true
categories: ELK
tags:
    - Logstash
    - ELK
---

# 案例
配置filebeats
```
filebeat.inputs:
- type: log
  paths:
    - /path/to/file/logstash-tutorial.log 
output.logstash:
  hosts: ["localhost:5044"]
```

运行filebeats
```
sudo ./filebeat -e -c filebeat.yml -d "publish"
```

配置logstash
vim first-pipeline.conf
```
input {
    beats {
        port => "5044"
    }
}
 filter {
    grok {
        match => { "message" => "%{COMBINEDAPACHELOG}"}
    }
    geoip {
        source => "clientip"
    }
}
output {
    elasticsearch {
        hosts => [ "localhost:9200" ]
    }
}
```

测试配置文件
```
bin/logstash -f first-pipeline.conf --config.test_and_exit
```
运行logstash
```
bin/logstash -f first-pipeline.conf --config.reload.automatic
```

修改first-pipeline.conf之后要删除Filebeat registry file，重新运行filebeats
```
sudo rm data/registry
