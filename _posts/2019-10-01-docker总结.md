---
layout:     post
title:      Docker
date:       2019-10-01
author:     BenderFly
header-img: img/post-bg-coffee.jpeg
catalog: true
categories: Docker
tags:
    - Docker
---

# 配置 Docker 镜像加速国内加速站点
```
vim /etc/docker/daemon.json
{
"insecure-registries":["主机的IP地址或者域名:5000"],
"registry-mirrors": ["https://registry.docker-cn.com"]
}

https://registry.docker-cn.com
http://hub-mirror.c.163.com
https://3laho3y3.mirror.aliyuncs.com
http://f1361db2.m.daocloud.io
https://mirror.ccs.tencentyun.com
```

# docker搭建本地私有仓库
1.拉取镜像仓库
```
docker pull registry 
```
2.启动镜像服务器registry
首先在在主机上新建一个目录，供存储镜像
```
cd /usr/local/
mkdir docker_registry 
````
启动镜像
```
docker run -d -p 5000:5000 --name=jackspeedregistry --restart=always --privileged=true  -v /usr/local/docker_registry:/var/lib/registry  docker.io/registry
```
解释
```
--privileged=true centos7中的安全模块selinux把权限禁止了, 加上这行是给容器增加执行权限
-v /usr/local/docker_registry:/var/lib/registry 把主机的/usr/local/docker_registry 目录挂载到registry容器的/var/lib/registry目录下,假如有删除容器操作,我们的镜像也不会被删除
```
3.从公有仓库拉取一个镜像下来,然后push到私有仓库中进行测试
当前用nginx镜像做测试
```
docker pull  nginx 
docker images 
```
4.给docker注册https协议,支持https访问
```
vim /etc/docker/daemon.json
{
"insecure-registries":["主机的IP地址或者域名:5000"],
"registry-mirrors": ["https://registry.docker-cn.com"]
}
注释:
insecure-registries--->开放注册https协议   # Docker 默认不允许非 HTTPS 方式推送镜像。所以要配置insecure-registries
registry-mirrors--->仓库源
```
5.新建一个tag,把docker.io/nginx名称变成域名或者IP/镜像名称
```
docker tag docker.io/nginx ip或者域名:5000/nginx
```
推送到本地仓库
```
docker push ip或者域名:5000/nginx 
```
6.用 curl 查看仓库中的镜像。
````
$ curl 127.0.0.1:5000/v2/_catalog
{"repositories":["ubuntu"]}
````
7.删除刚刚tag的镜像 （11.*****:5000/nginx刚才创建的镜像的tag）
```
docker rmi 111.*****:5000/nginx
docker rmi  nginx 
```
8.拉取刚刚自己创建的镜像
```
docker pull 111.*****:5000/nginx
```


![getopts](https://raw.githubusercontent.com/handerfly/handerfly.github.io/master/img/getopt.png)  

[参考](https://www.linuxprobe.com/screen-example.html)